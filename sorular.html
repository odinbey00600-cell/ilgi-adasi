<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bilgi Adasƒ± - √áocuk Bilgi Yarƒ±≈ümasƒ±</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts: Fredoka One for a playful look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">

    <!-- Font Awesome for Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Custom styles for the app */
        body {
            font-family: 'Fredoka One', cursive;
            -webkit-tap-highlight-color: transparent; /* Disable tap highlight on mobile */
        }

        /* Custom animation for popping elements */
        @keyframes pop {
            0% { transform: scale(0.8); opacity: 0; }
            70% { transform: scale(1.05); opacity: 1; }
            100% { transform: scale(1.0); opacity: 1; }
        }
        .animate-pop {
            animation: pop 0.5s ease-out forwards;
        }

        /* Custom animation for correct answer */
        @keyframes correct-answer {
            0% { transform: scale(1); }
            50% { transform: scale(1.1) rotate(3deg); }
            100% { transform: scale(1); }
        }
        .correct {
            animation: correct-answer 0.5s ease;
            background-color: #22c55e !important; /* green-500 */
            color: white !important;
            border-color: #16a34a !important; /* green-600 */
        }

        /* Custom animation for incorrect answer */
        @keyframes incorrect-answer {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-10px); }
            40% { transform: translateX(10px); }
            60% { transform: translateX(-10px); }
            80% { transform: translateX(10px); }
        }
        .incorrect {
            animation: incorrect-answer 0.5s ease;
            background-color: #ef4444 !important; /* red-500 */
            color: white !important;
            border-color: #dc2626 !important; /* red-600 */
        }
        
        /* Custom scrollbar for better look */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #f1f5f9; border-radius: 10px; }
        ::-webkit-scrollbar-thumb { background: #60a5fa; border-radius: 10px; }
        ::-webkit-scrollbar-thumb:hover { background: #3b82f6; }
    </style>
</head>
<body class="bg-blue-100 overflow-hidden select-none">

    <div id="app-container" class="relative w-screen h-screen max-w-lg mx-auto bg-white shadow-2xl overflow-hidden">

        <!-- 1. User Name Screen -->
        <div id="name-screen" class="w-full h-full flex flex-col items-center justify-center p-8 bg-gradient-to-br from-green-400 to-cyan-500 text-white">
             <i class="fas fa-user-astronaut text-7xl mb-6"></i>
            <h1 class="text-4xl font-bold mb-4" data-translate="whatsYourName">Adƒ±n ne?</h1>
            <p class="text-lg mb-8" data-translate="enterYourName">Avatarƒ±n i√ßin bir isim gir.</p>
            <input id="name-input" type="text" class="w-full max-w-xs text-center text-2xl p-3 rounded-xl shadow-inner text-gray-800 focus:outline-none focus:ring-4 focus:ring-yellow-300" placeholder="Kahraman">
            <button onclick="submitName()" class="w-full max-w-xs mt-6 bg-yellow-400 text-gray-800 py-4 rounded-xl text-2xl font-bold shadow-md transform hover:scale-105 transition-transform" data-translate="letsGo">Hadi Ba≈ülayalƒ±m!</button>
        </div>

        <!-- 2. Main Menu (Category Selection) -->
        <div id="main-menu-screen" class="hidden w-full h-full flex flex-col bg-slate-50">
            <!-- Header -->
            <header class="flex items-center justify-between p-4 bg-white shadow-md">
                <div class="flex items-center space-x-3">
                    <div id="avatar-display" class="w-14 h-14 bg-yellow-300 rounded-full flex items-center justify-center text-3xl cursor-pointer relative" onclick="openAvatarCustomizer()">
                        <span>üßë‚ÄçüöÄ</span>
                    </div>
                    <div>
                        <h2 id="user-name-display" class="font-bold text-lg text-gray-700"></h2>
                        <div class="flex items-center space-x-2 text-yellow-500">
                            <i class="fas fa-star"></i>
                            <span id="score-display" class="font-bold text-lg">0</span>
                        </div>
                    </div>
                </div>
                <button onclick="showParentSection()" class="bg-blue-500 text-white px-4 py-2 rounded-lg shadow-md hover:bg-blue-600 transition-colors">
                    <i class="fas fa-user-shield mr-2"></i><span data-translate="parentSection">Ebeveyn</span>
                </button>
            </header>

            <!-- Category Grid -->
            <main class="flex-1 overflow-y-auto p-4">
                <h1 class="text-2xl font-bold text-center text-gray-800 my-4" data-translate="selectCategory">Bir Kategori Se√ß</h1>
                <div id="category-grid" class="grid grid-cols-2 sm:grid-cols-3 gap-4">
                    <!-- Categories will be injected here by JS -->
                </div>
            </main>
        </div>

        <!-- 3. Difficulty Selection Screen -->
        <div id="difficulty-screen" class="hidden w-full h-full flex flex-col items-center justify-center p-8 bg-gradient-to-br from-purple-400 to-pink-500 text-white">
            <h1 id="difficulty-title" class="text-4xl font-bold mb-12"></h1>
            <div class="space-y-6 w-full max-w-xs">
                <button onclick="startGame('easy')" class="w-full bg-green-400 py-5 rounded-2xl text-3xl font-bold shadow-lg transform hover:scale-105 transition-transform border-b-4 border-green-600" data-translate="easy">Kolay</button>
                <button onclick="startGame('medium')" class="w-full bg-yellow-400 py-5 rounded-2xl text-3xl font-bold shadow-lg transform hover:scale-105 transition-transform border-b-4 border-yellow-600" data-translate="medium">Orta</button>
                <button onclick="startGame('hard')" class="w-full bg-red-500 py-5 rounded-2xl text-3xl font-bold shadow-lg transform hover:scale-105 transition-transform border-b-4 border-red-700 flex items-center justify-center">
                    <span data-translate="hard">Zor</span>
                    <i class="fas fa-lock ml-3"></i>
                </button>
            </div>
             <button onclick="showScreen('main-menu-screen')" class="mt-12 text-white text-lg underline"><i class="fas fa-arrow-left mr-2"></i> <span data-translate="backToCategories">Geri D√∂n</span></button>
        </div>
        
        <!-- 4. Game Screen -->
        <div id="game-screen" class="hidden w-full h-full flex flex-col p-4 bg-slate-100">
            <!-- Game Header -->
            <div class="flex items-center justify-between mb-4">
                <button onclick="endGame(true)" class="text-gray-500 text-2xl"><i class="fas fa-times"></i></button>
                <div class="flex-1 text-center">
                    <div class="w-full bg-gray-300 rounded-full h-4">
                        <div id="progress-bar" class="bg-green-500 h-4 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                </div>
                <div class="flex items-center text-yellow-500 text-2xl ml-4">
                    <i class="fas fa-star"></i>
                    <span id="game-score-display" class="font-bold ml-1">0</span>
                </div>
            </div>
            
            <!-- Question Area -->
            <div class="flex-1 flex flex-col items-center justify-center bg-white rounded-2xl shadow-lg p-6">
                 <div id="question-image-container" class="mb-4"></div>
                <h2 id="question-text" class="text-2xl md:text-3xl text-center font-bold text-gray-800">Soru metni buraya gelecek...</h2>
            </div>
            
            <!-- Options Area -->
            <div id="options-container" class="grid grid-cols-2 gap-4 mt-6">
                <!-- Options will be injected here -->
            </div>
        </div>

        <!-- 5. Results Screen -->
        <div id="results-screen" class="hidden w-full h-full flex flex-col items-center justify-center p-8 bg-gradient-to-br from-yellow-300 to-orange-400 text-gray-800">
            <i class="fas fa-trophy text-8xl text-white mb-6"></i>
            <h1 class="text-4xl font-bold mb-4" data-translate="wellDone">Harika ƒ∞≈ü!</h1>
            <p class="text-2xl mb-2" data-translate="yourScore">Puanƒ±n</p>
            <p id="final-score" class="text-7xl font-bold mb-10">120</p>
            <div class="flex space-x-4">
                <button onclick="restartGame()" class="bg-white text-orange-500 py-3 px-8 rounded-xl text-xl font-bold shadow-md transform hover:scale-105 transition-transform" data-translate="playAgain">Tekrar Oyna</button>
                <button onclick="showScreen('main-menu-screen')" class="bg-green-500 text-white py-3 px-8 rounded-xl text-xl font-bold shadow-md transform hover:scale-105 transition-transform" data-translate="mainMenu">Ana Men√º</button>
            </div>
        </div>

        <!-- Modals -->
        <!-- Ad Simulation Modal -->
        <div id="ad-modal" class="hidden absolute inset-0 bg-black bg-opacity-80 flex flex-col items-center justify-center text-white z-50">
            <i class="fas fa-spinner fa-spin text-6xl mb-6"></i>
            <h2 class="text-3xl font-bold" data-translate="adLoading">Reklam y√ºkleniyor...</h2>
            <p class="text-lg mt-2" data-translate="unlockingHard">Zor seviye a√ßƒ±lƒ±yor!</p>
        </div>

        <!-- Parent Section Modal -->
        <div id="parent-modal" class="hidden absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl p-6 w-full max-w-md animate-pop">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800" data-translate="progressReport">Geli≈üim Raporu</h2>
                    <button onclick="closeModal('parent-modal')" class="text-gray-500 text-2xl">&times;</button>
                </div>
                <div id="parent-report-content" class="text-gray-600 space-y-2">
                    <!-- Report content will be injected here -->
                </div>
            </div>
        </div>
        
        <!-- Badge Unlocked Modal -->
        <div id="badge-modal" class="hidden absolute inset-0 bg-black bg-opacity-70 flex items-center justify-center z-50 p-4">
            <div class="bg-gradient-to-br from-blue-400 to-purple-500 text-white rounded-2xl p-8 w-full max-w-sm text-center animate-pop">
                <i id="badge-icon" class="text-8xl mb-4">üåü</i>
                <h2 class="text-3xl font-bold mb-2" data-translate="badgeUnlocked">Rozet Kazandƒ±n!</h2>
                <p id="badge-name" class="text-xl mb-6"></p>
                <button onclick="closeModal('badge-modal')" class="bg-white text-blue-500 py-2 px-8 rounded-xl text-lg font-bold shadow-md">Harika!</button>
            </div>
        </div>

        <!-- Avatar Customizer Modal -->
        <div id="avatar-modal" class="hidden absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
            <div class="bg-white rounded-2xl p-6 w-full max-w-md animate-pop">
                 <div class="flex justify-between items-center mb-4">
                    <h2 class="text-2xl font-bold text-gray-800" data-translate="customizeAvatar">Avatarƒ± √ñzelle≈ütir</h2>
                    <button onclick="closeModal('avatar-modal')" class="text-gray-500 text-2xl">&times;</button>
                </div>
                <!-- Avatar Preview -->
                <div class="w-32 h-32 mx-auto bg-yellow-200 rounded-full flex items-center justify-center relative mb-4">
                    <span id="avatar-base-preview" class="text-7xl">üßë‚ÄçüöÄ</span>
                    <div id="avatar-hat-preview" class="absolute -top-4 text-6xl"></div>
                </div>
                <!-- Customization Options -->
                <div class="grid grid-cols-3 gap-4 text-center">
                    <div class="p-2 border rounded-lg cursor-pointer" onclick="buyAvatarItem('hat', 'üé©', 100)">
                        <span class="text-4xl">üé©</span>
                        <p class="text-sm font-bold text-yellow-500"><i class="fas fa-star"></i> 100</p>
                    </div>
                     <div class="p-2 border rounded-lg cursor-pointer" onclick="buyAvatarItem('hat', 'üëë', 500)">
                        <span class="text-4xl">üëë</span>
                        <p class="text-sm font-bold text-yellow-500"><i class="fas fa-star"></i> 500</p>
                    </div>
                     <div class="p-2 border rounded-lg cursor-pointer" onclick="buyAvatarItem('hat', 'üéì', 250)">
                        <span class="text-4xl">üéì</span>
                        <p class="text-sm font-bold text-yellow-500"><i class="fas fa-star"></i> 250</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- APPLICATION STATE ---
        const appState = {
            lang: 'tr',
            userName: '',
            score: 0,
            currentCategory: null,
            currentDifficulty: null,
            questions: [],
            currentQuestionIndex: 0,
            userAnswers: {}, // { 'category_difficulty': { correct: 2, total: 5, name: 'Category Name' } }
            unlockedBadges: [],
            avatar: {
                base: 'üßë‚ÄçüöÄ',
                hat: null
            }
        };

        // --- DOM ELEMENTS ---
        const dom = {
            screens: document.querySelectorAll('#app-container > div[id$="-screen"]'),
            modals: {
                ad: document.getElementById('ad-modal'),
                parent: document.getElementById('parent-modal'),
                badge: document.getElementById('badge-modal'),
                avatar: document.getElementById('avatar-modal'),
            },
            nameInput: document.getElementById('name-input'),
            userNameDisplay: document.getElementById('user-name-display'),
            scoreDisplay: document.getElementById('score-display'),
            gameScoreDisplay: document.getElementById('game-score-display'),
            categoryGrid: document.getElementById('category-grid'),
            difficultyTitle: document.getElementById('difficulty-title'),
            questionText: document.getElementById('question-text'),
            questionImageContainer: document.getElementById('question-image-container'),
            optionsContainer: document.getElementById('options-container'),
            progressBar: document.getElementById('progress-bar'),
            finalScore: document.getElementById('final-score'),
            parentReportContent: document.getElementById('parent-report-content'),
            avatarDisplay: document.getElementById('avatar-display'),
            avatarBasePreview: document.getElementById('avatar-base-preview'),
            avatarHatPreview: document.getElementById('avatar-hat-preview'),
        };

        // --- TRANSLATIONS & CONFIG ---
        const translations = {
            tr: {
                whatsYourName: "Adƒ±n ne?",
                enterYourName: "Avatarƒ±n i√ßin bir isim gir.",
                letsGo: "Hadi Ba≈ülayalƒ±m!",
                parentSection: "Ebeveyn",
                selectCategory: "Bir Kategori Se√ß",
                backToCategories: "Geri D√∂n",
                easy: "Kolay",
                medium: "Orta",
                hard: "Zor",
                wellDone: "Harika ƒ∞≈ü!",
                yourScore: "Puanƒ±n",
                playAgain: "Tekrar Oyna",
                mainMenu: "Ana Men√º",
                adLoading: "Reklam y√ºkleniyor...",
                unlockingHard: "Zor seviye a√ßƒ±lƒ±yor!",
                progressReport: "Geli≈üim Raporu",
                badgeUnlocked: "Rozet Kazandƒ±n!",
                customizeAvatar: "Avatarƒ± √ñzelle≈ütir",
                reportLine: (category, correct, total) => `${category}: ${total} sorudan ${correct} doƒüru.`,
                noData: "Hen√ºz veri yok."
            }
        };

        const categories = [
            { id: 'general_knowledge', icon: 'üåç', color: 'bg-blue-400' },
            { id: 'science', icon: 'üî¨', color: 'bg-purple-400' },
            { id: 'math', icon: '‚ûó', color: 'bg-orange-400' },
            { id: 'language', icon: 'üî§', color: 'bg-pink-400' },
            { id: 'history', icon: 'üèõÔ∏è', color: 'bg-amber-500' },
            { id: 'riddles', icon: '‚ùì', color: 'bg-teal-400' },
            { id: 'guess_the_picture', icon: 'üñºÔ∏è', color: 'bg-indigo-400' },
            { id: 'true_false', icon: 'üëçüëé', color: 'bg-lime-500' },
            { id: 'environment', icon: '‚ôªÔ∏è', color: 'bg-green-500' },
            { id: 'health', icon: '‚ù§Ô∏è', color: 'bg-red-400' },
            { id: 'social', icon: 'ü§ù', color: 'bg-yellow-400' },
        ];
        
        const categoryNames = {
            tr: {
                general_knowledge: 'Genel K√ºlt√ºr', science: 'Bilim', math: 'Matematik', language: 'Dil Bilgisi', history: 'Tarih', riddles: 'Bilmeceler', guess_the_picture: 'Resim Tahmin', true_false: 'Doƒüru/Yanlƒ±≈ü', environment: '√áevre', health: 'Saƒülƒ±k', social: 'Sosyal'
            }
        };

        const badges = [
            { name: { tr: "Acemi Ka≈üif" }, icon: "üß≠", score: 100 },
            { name: { tr: "Bilgi Avcƒ±sƒ±" }, icon: "üèπ", score: 500 },
            { name: { tr: "Yƒ±ldƒ±z √ñƒürenci" }, icon: "üåü", score: 1000 },
            { name: { tr: "Evrenin Hakimi" }, icon: "ü™ê", score: 2500 },
        ];

        // --- ALL QUESTIONS DATA ---
        const allQuestions = {
            tr: {
                general_knowledge: {
                    easy: [
                        { question: "K√∂pekler hangi sesi √ßƒ±karƒ±r?", options: ["Miyav", "Hav", "Vƒ±z", "Mee"], answer: 1 },
                        { question: "T√ºrkiye'nin ba≈ükenti neresidir?", options: ["ƒ∞stanbul", "ƒ∞zmir", "Ankara", "Bursa"], answer: 2 },
                        { question: "G√ºne≈ü hangi y√∂nden doƒüar?", options: ["Batƒ±", "Kuzey", "Doƒüu", "G√ºney"], answer: 2 }
                    ],
                    medium: [
                        { question: "D√ºnyanƒ±n en y√ºksek daƒüƒ± hangisidir?", options: ["Aƒürƒ± Daƒüƒ±", "Alpler", "Everest", "Uludaƒü"], answer: 2 }
                    ],
                    hard: [
                        { question: "Ay'a ilk ayak basan insan kimdir?", options: ["Isaac Newton", "Albert Einstein", "Yuri Gagarin", "Neil Armstrong"], answer: 3 }
                    ]
                },
                science: {
                    easy: [
                        { question: "Su ka√ß derecede kaynar?", options: ["50", "100", "200", "0"], answer: 1 }
                    ]
                },
                guess_the_picture: {
                    easy: [
                         { question: "Bu hangi hayvan?", image: "https://placehold.co/150x150/f97316/ffffff?text=Aslan", options: ["Kedi", "Kaplan", "Aslan", "K√∂pek"], answer: 2 }
                    ]
                }
            }
        };


        // --- CORE FUNCTIONS ---

        function showScreen(screenId) {
            dom.screens.forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
            document.getElementById(screenId).classList.add('animate-pop');
        }
        
        function updateUIText() {
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                if (translations[appState.lang][key]) {
                    el.innerText = translations[appState.lang][key];
                }
            });
            renderCategories();
        }

        function submitName() {
            const name = dom.nameInput.value.trim();
            if (name) {
                appState.userName = name;
                dom.userNameDisplay.innerText = appState.userName;
                showScreen('main-menu-screen');
            } else {
                dom.nameInput.classList.add('border-2', 'border-red-500');
            }
        }

        function renderCategories() {
            dom.categoryGrid.innerHTML = '';
            categories.forEach(cat => {
                const catName = categoryNames[appState.lang][cat.id] || cat.id;
                const catElement = document.createElement('div');
                catElement.className = `p-4 ${cat.color} rounded-2xl text-white text-center flex flex-col items-center justify-center aspect-square cursor-pointer transform hover:scale-105 transition-transform shadow-lg border-b-4 border-black/20`;
                catElement.innerHTML = `
                    <div class="text-5xl">${cat.icon}</div>
                    <h3 class="mt-2 font-bold text-lg">${catName}</h3>
                `;
                catElement.onclick = () => selectCategory(cat.id);
                dom.categoryGrid.appendChild(catElement);
            });
        }
        
        function selectCategory(categoryId) {
            appState.currentCategory = categoryId;
            const catName = categoryNames[appState.lang][categoryId] || categoryId;
            dom.difficultyTitle.innerText = catName;
            showScreen('difficulty-screen');
        }

        function loadQuestions(category, difficulty) {
            try {
                // Get questions from the embedded 'allQuestions' object
                const questions = allQuestions[appState.lang]?.[category]?.[difficulty];
                if (!questions || questions.length === 0) {
                    throw new Error(`No questions found for ${appState.lang}/${category}/${difficulty}`);
                }
                appState.questions = questions;
                return true;
            } catch (error) {
                console.error('Failed to load questions from object:', error);
                // Fallback to dummy data if loading from object fails
                appState.questions = getDummyQuestions(difficulty);
                return true;
            }
        }

        function startGame(difficulty) {
            if (difficulty === 'hard') {
                simulateAd().then(() => {
                    startQuiz(difficulty);
                });
            } else {
                startQuiz(difficulty);
            }
        }
        
        function startQuiz(difficulty) {
            appState.currentDifficulty = difficulty;
            appState.currentQuestionIndex = 0;
            const loaded = loadQuestions(appState.currentCategory, appState.currentDifficulty);
            
            if(loaded && appState.questions && appState.questions.length > 0) {
                showScreen('game-screen');
                displayQuestion();
            } else {
                // Using a custom modal/alert would be better in a real app
                alert(`Bu kategori i√ßin soru bulunamadƒ±: ${appState.currentCategory} - ${appState.currentDifficulty}`);
                showScreen('difficulty-screen');
            }
        }

        function displayQuestion() {
            if (appState.currentQuestionIndex >= appState.questions.length) {
                endGame();
                return;
            }

            const question = appState.questions[appState.currentQuestionIndex];
            dom.questionText.innerText = question.question;
            dom.optionsContainer.innerHTML = '';
            dom.questionImageContainer.innerHTML = '';

            // Display image if it exists for the question
            if (question.image) {
                dom.questionImageContainer.innerHTML = `<img src="${question.image}" alt="Question Image" class="max-h-40 rounded-lg mx-auto">`;
            }

            // Update progress bar
            const progress = ((appState.currentQuestionIndex + 1) / appState.questions.length) * 100;
            dom.progressBar.style.width = `${progress}%`;
            dom.gameScoreDisplay.innerText = appState.score;

            question.options.forEach((option, index) => {
                const optionButton = document.createElement('button');
                optionButton.className = "bg-white p-4 rounded-xl text-gray-700 font-bold text-lg shadow-md border-b-4 border-gray-300 transform hover:bg-blue-100 transition-colors";
                optionButton.innerText = option;
                optionButton.onclick = () => selectAnswer(index);
                dom.optionsContainer.appendChild(optionButton);
            });
        }

        function selectAnswer(selectedIndex) {
            const question = appState.questions[appState.currentQuestionIndex];
            const buttons = dom.optionsContainer.querySelectorAll('button');
            buttons.forEach(button => button.disabled = true); // Disable all buttons

            const isCorrect = selectedIndex === question.answer;
            const selectedButton = buttons[selectedIndex];

            if (isCorrect) {
                selectedButton.classList.add('correct');
                updateScore(10); // Add 10 points for correct answer
            } else {
                selectedButton.classList.add('incorrect');
                if (buttons[question.answer]) {
                    buttons[question.answer].classList.add('correct');
                }
            }
            
            // Track performance
            const key = `${appState.currentCategory}_${appState.currentDifficulty}`;
            if (!appState.userAnswers[key]) {
                appState.userAnswers[key] = { correct: 0, total: 0, name: categoryNames[appState.lang][appState.currentCategory] };
            }
            appState.userAnswers[key].total++;
            if (isCorrect) {
                appState.userAnswers[key].correct++;
            }

            setTimeout(() => {
                appState.currentQuestionIndex++;
                displayQuestion();
            }, 1500);
        }
        
        function updateScore(points) {
            const oldScore = appState.score;
            appState.score += points;
            dom.scoreDisplay.innerText = appState.score;
            dom.gameScoreDisplay.innerText = appState.score;
            checkBadges(oldScore);
        }
        
        function checkBadges(oldScore) {
            badges.forEach(badge => {
                if (appState.score >= badge.score && oldScore < badge.score && !appState.unlockedBadges.includes(badge.name.tr)) {
                    appState.unlockedBadges.push(badge.name.tr);
                    showBadgeModal(badge);
                }
            });
        }
        
        function showBadgeModal(badge) {
            document.getElementById('badge-icon').innerText = badge.icon;
            document.getElementById('badge-name').innerText = badge.name[appState.lang];
            dom.modals.badge.classList.remove('hidden');
        }

        function endGame(isQuit = false) {
            if (isQuit) {
                showScreen('main-menu-screen');
                return;
            }
            dom.finalScore.innerText = appState.score;
            showScreen('results-screen');
        }
        
        function restartGame() {
            startQuiz(appState.currentDifficulty);
        }

        function simulateAd() {
            return new Promise(resolve => {
                dom.modals.ad.classList.remove('hidden');
                setTimeout(() => {
                    dom.modals.ad.classList.add('hidden');
                    resolve();
                }, 3000); // 3-second ad simulation
            });
        }
        
        function showParentSection() {
            dom.parentReportContent.innerHTML = '';
            const reportKeys = Object.keys(appState.userAnswers);
            if (reportKeys.length === 0) {
                dom.parentReportContent.innerText = translations[appState.lang].noData;
            } else {
                reportKeys.forEach(key => {
                    const data = appState.userAnswers[key];
                    const p = document.createElement('p');
                    p.innerText = translations[appState.lang].reportLine(data.name, data.correct, data.total);
                    dom.parentReportContent.appendChild(p);
                });
            }
            dom.modals.parent.classList.remove('hidden');
        }

        function openAvatarCustomizer() {
            dom.modals.avatar.classList.remove('hidden');
        }

        function buyAvatarItem(type, item, cost) {
            if (appState.score >= cost) {
                updateScore(-cost);
                if (type === 'hat') {
                    appState.avatar.hat = item;
                    // Update main avatar display
                    const avatarContainer = dom.avatarDisplay;
                    avatarContainer.innerHTML = `<span>${appState.avatar.base}</span>`;
                    if (appState.avatar.hat) {
                        avatarContainer.innerHTML += `<div class="absolute -top-3 text-3xl">${appState.avatar.hat}</div>`;
                    }
                    // Update modal preview
                    dom.avatarHatPreview.innerText = item;
                }
                closeModal('avatar-modal');
            } else {
                // Using a custom modal/alert would be better in a real app
                alert("Yeterli puanƒ±n yok!");
            }
        }
        
        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // --- DUMMY DATA (FALLBACK) ---
        function getDummyQuestions(difficulty) {
            const dummyData = {
                easy: [
                    { question: "2 + 2 ka√ßtƒ±r?", options: ["3", "4", "5", "6"], answer: 1 },
                    { question: "G√∂ky√ºz√º ne renktir?", options: ["Ye≈üil", "Mavi", "Kƒ±rmƒ±zƒ±", "Sarƒ±"], answer: 1 }
                ],
                medium: [
                    { question: "Fransa'nƒ±n ba≈ükenti neresidir?", options: ["Londra", "Berlin", "Paris", "Madrid"], answer: 2 },
                ],
                hard: [
                    { question: "H2O nedir?", options: ["Hava", "Ate≈ü", "Su", "Toprak"], answer: 2 },
                ]
            };
            return dummyData[difficulty] || [];
        }

        // --- INITIALIZATION ---
        document.addEventListener('DOMContentLoaded', () => {
            updateUIText();
            showScreen('name-screen');
        });

    </script>
</body>
</html>
